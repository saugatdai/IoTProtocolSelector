<!DOCTYPE html>
<html>

<head>
    <title>CoAP Subplots: Payload Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: sans-serif;
            background-color: #f4f4f4;
        }

        .controls {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
        }

        button:hover {
            background-color: #218838;
        }

        #plotDiv {
            width: 100%;
            height: 100vh;
        }

        nav {
            width: 40%;
            margin: 0 auto;
            text-align: center;
        }

        nav a {
            text-decoration: none;
            color: #007bff;
            font-size: 16px;
            margin: 0 10px;
        }

        nav a:hover {
            color: #0056b3;
        }

        nav a:active {
            color: #0056b3;
        }

        nav a:visited {
            color: #0056b3;
        }
    </style>
</head>

<body>

    <nav>
        <a href="index.html">Home</a>
        <a href="MQTT.html">MQTT</a>
        <a href="COAP.html">COAP</a>
        <a href="HTTP.html">HTTP</a>
    </nav>

    <div class="controls">
        <h2>CoAP Performance by Payload Size</h2>
        <p>X-Axis: Rate | Y-Axis: Clients | Z-Axis: Performance Metric</p>
        <button onclick="toggleMetric()">Switch to RAM Usage</button>
        <h3 id="metricLabel" style="margin-top: 10px; color: #333;">Displaying: CPU Usage (%)</h3>
    </div>

    <div id="plotDiv"></div>

    <script>
        // --- DATA: CoAP ---
        // Payloads: 2, 64, 512, 1024, 2000
        const coap_x = [
            [2, 1, 10], [64, 1, 10], [512, 1, 10], [1024, 1, 10], [2000, 1, 10], [2, 10, 10], [64, 10, 10],
            [512, 10, 10], [1024, 10, 10], [2000, 10, 10], [2, 100, 10], [64, 100, 10], [512, 100, 10],
            [1024, 100, 10], [2000, 100, 10], [2, 200, 10], [64, 200, 10], [512, 200, 10], [1024, 200, 10],
            [2000, 200, 10], [2, 1, 100], [64, 1, 100], [512, 1, 100], [1024, 1, 100], [2000, 1, 100], [2, 10, 100],
            [64, 10, 100], [512, 10, 100], [1024, 10, 100], [2000, 10, 100], [2, 100, 100], [64, 100, 100],
            [512, 100, 100], [1024, 100, 100], [2000, 100, 100], [2, 200, 100], [64, 200, 100], [512, 200, 100],
            [1024, 200, 100], [2000, 200, 100], [2, 1, 1000], [64, 1, 1000], [512, 1, 1000], [1024, 1, 1000],
            [2000, 1, 1000], [2, 10, 1000], [64, 10, 1000], [512, 10, 1000], [1024, 10, 1000], [2000, 10, 1000],
            [2, 100, 1000], [64, 100, 1000], [512, 100, 1000], [1024, 100, 1000], [2000, 100, 1000], [2, 200, 1000],
            [64, 200, 1000], [512, 200, 1000], [1024, 200, 1000], [2000, 200, 1000]
        ];

        const coap_y = [
            [0.1, 1.1], [0.1, 1], [0.1, 1.2], [0.1, 1.1], [0.1, 1], [1.9, 9.2], [1.8, 21.7], [1.7, 22.3], [1.9, 25.8],
            [1.9, 30.7], [5, 143.1], [6.8, 144], [6.4, 145.9], [6.8, 147.1], [7.4, 178], [7.3, 251.1], [7.4, 268.9],
            [7.2, 261.9], [7.5, 313.4], [7.6, 383.9], [1.2, 23.6], [1.3, 24.5], [1.3, 25.9], [1.4, 26.1], [1.4, 30.3],
            [5, 156], [5, 168], [5.1, 189], [5.2, 197.1], [5.2, 210.2], [23.9, 748], [22.8, 742.9], [20.9, 700.9],
            [24.7, 706], [24.8, 755.8], [23.4, 703.9], [21.8, 701.9], [20.1, 711.3], [20.8, 714], [21.7, 725.9],
            [3.2, 147.6], [3.3, 155.9], [3.3, 156.9], [3.4, 168.8], [3.5, 213.9], [13.8, 651.7], [14.2, 670],
            [12.7, 663], [12.6, 714], [12.5, 728], [12.7, 705.9], [13.1, 637.9], [12.6, 661], [13.7, 735.9], [13.3, 749.7],
            [13.6, 675.2], [13.6, 751], [13.8, 765], [13.8, 799], [13.9, 801]
        ];

        // Axis Categories
        const payloads = [2, 64, 512, 1024, 2000]; // Differ from MQTT
        const rates = [1, 10, 100, 200];
        const clients = [10, 100, 1000];

        // Helper: Create Z-Matrix
        function getZMatrix(targetPayload, metricIndex) {
            let z = [];
            for (let c = 0; c < clients.length; c++) {
                let row = [];
                for (let r = 0; r < rates.length; r++) {
                    const matchIndex = coap_x.findIndex(item =>
                        item[0] === targetPayload && item[1] === rates[r] && item[2] === clients[c]
                    );
                    row.push(matchIndex !== -1 ? coap_y[matchIndex][metricIndex] : 0);
                }
                z.push(row);
            }
            return z;
        }

        let currentMetric = 0;

        function drawPlot() {
            const metricName = currentMetric === 0 ? "CPU Usage (%)" : "RAM Usage (MB)";
            const traces = [];

            payloads.forEach((pl, index) => {
                traces.push({
                    type: 'surface',
                    x: rates, y: clients, z: getZMatrix(pl, currentMetric),
                    scene: `scene${index + 1}`,
                    name: `${pl} Bytes`,
                    colorscale: 'Greens', // Distinct color for CoAP
                    showscale: false, opacity: 0.9
                });
            });

            const layout = {
                title: `CoAP Analysis: ${metricName}`,
                height: 900,
                margin: { l: 20, r: 20, b: 20, t: 80 },
                // Layout for 5 plots
                scene1: { domain: { x: [0, 0.33], y: [0.55, 1] }, annotations: [{ text: "Payload: 2 B" }], xaxis: { title: 'Rate' }, yaxis: { title: 'Clients' }, zaxis: { title: metricName } },
                scene2: { domain: { x: [0.33, 0.66], y: [0.55, 1] }, annotations: [{ text: "Payload: 64 B" }], xaxis: { title: 'Rate' }, yaxis: { title: 'Clients' }, zaxis: { title: metricName } },
                scene3: { domain: { x: [0.66, 1], y: [0.55, 1] }, annotations: [{ text: "Payload: 512 B" }], xaxis: { title: 'Rate' }, yaxis: { title: 'Clients' }, zaxis: { title: metricName } },
                scene4: { domain: { x: [0, 0.33], y: [0, 0.45] }, annotations: [{ text: "Payload: 1024 B" }], xaxis: { title: 'Rate' }, yaxis: { title: 'Clients' }, zaxis: { title: metricName } },
                scene5: { domain: { x: [0.33, 0.66], y: [0, 0.45] }, annotations: [{ text: "Payload: 2000 B" }], xaxis: { title: 'Rate' }, yaxis: { title: 'Clients' }, zaxis: { title: metricName } }
            };

            Plotly.newPlot('plotDiv', traces, layout);
            document.getElementById('metricLabel').innerText = `Displaying: ${metricName}`;
            document.querySelector('button').innerText = currentMetric === 0 ? "Switch to RAM Usage" : "Switch to CPU Usage";
        }

        function toggleMetric() { currentMetric = currentMetric === 0 ? 1 : 0; drawPlot(); }
        drawPlot();
    </script>
</body>

</html>